<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rors">
<title>Installing and setting up OpenRouteService locally • rors</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.8/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Installing and setting up OpenRouteService locally">
<meta property="og:description" content="rors">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rors</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
    Overview
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--vignettes">
    <span class="fa fa-book"></span>
     
    Vignettes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--vignettes">
    <a class="dropdown-item" href="../articles/ors-installation.html">OpenRouteService setup</a>
    <a class="dropdown-item" href="../articles/ors-routing.html">Routing functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-search"></span>
     
    Reference
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JsLth/rors/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Installing and setting up OpenRouteService locally</h1>
                        <h4 data-toc-skip class="author">Jonas
Lieth</h4>
            
            <h4 data-toc-skip class="date">2024-02-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JsLth/rors/blob/HEAD/vignettes/ors-installation.Rmd" class="external-link"><code>vignettes/ors-installation.Rmd</code></a></small>
      <div class="d-none name"><code>ors-installation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-do-the-routing-functions-not-work-off-the-shelf">Why do the routing functions not work off the shelf?<a class="anchor" aria-label="anchor" href="#why-do-the-routing-functions-not-work-off-the-shelf"></a>
</h2>
<p><code>rors</code> is powered by OpenRouteService (ORS) and as such
depends on a running ORS instance. If you did not mount a working ORS
instance first, all routing functions will throw an error. An
OpenRouteService instance is a server that can be communicated with
using a specified REST API. This can be</p>
<ul>
<li>The <a href="https://api.openrouteservice.org" class="external-link">public API</a>
</li>
<li>Any kind of remote server that runs ORS</li>
<li>A self-built ORS on a local host</li>
</ul>
<p>Instances are controlled through the <code>ors_instance</code>
functions and the ORS setup function family. The resulting
<code>ors_instance</code> object is automatically attached to the
session and detected by all routing functions in the package.</p>
<p>If you have no interest in setting up a local instance and just want
to make quick routing requests, you can grab a free API key from the <a href="https://openrouteservice.org/" class="external-link">official website</a> and chuck it
into the <code>ORS_TOKEN</code> environment variable. It is best
practice to do so without exposing the token to R code, e.g. through an
<a href="https://rstats.wtf/r-startup.html#renviron" class="external-link"><code>.Renviron</code></a>
file. After doing so, you can call <code>ors_instance</code> to attach
the token to your session.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `server = "pub"` is short for https://api.openrouteservice.org/</span></span>
<span><span class="va">public</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ors_instance.html">ors_instance</a></span><span class="op">(</span>server <span class="op">=</span> <span class="st">"pub"</span><span class="op">)</span></span>
<span><span class="va">public</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/public-api.svg" width="100%"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">public</span><span class="op">$</span><span class="va">token</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/token.svg" width="100%"></p>
<p>After doing this, all functions should be ready to use. Keep in mind
though, that the public API comes with a few caveats:</p>
<ul>
<li>It is restricted at a rate limit of 40 requests per minute and 2000
requests per day. <code>rors</code> automatically throttles requests to
the public API such that queries will inevitably be slow for larger
analyses.</li>
<li>It is a remote service that handles potentially sensitive address
data. If data privacy is a concern, online services are usually not an
option.</li>
<li>It runs on a relatively strict configuration that severely limits
the amount of data or ways to process the data. For example, requests to
the isochrone endpoint are only allowed to contain a maximum of five
locations:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ors_accessibility.html">ors_accessibility</a></span><span class="op">(</span><span class="va">pharma</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/error.svg" width="100%"></p>
<p>Therefore, if you plan on working with larger datasets, if you are
limited by server-side restrictions of the public API, or if you’re
handling sensitive data, it is strongly suggested that you set up a
local instance. This vignette will cover the usage of
<code>ors_instance</code> and family to construct and start a customized
ORS instance using R.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-service-backend">Setting up the service backend<a class="anchor" aria-label="anchor" href="#setting-up-the-service-backend"></a>
</h2>
<p>In order to set up the ORS backend locally, we need three things:</p>
<ul>
<li>Docker</li>
<li>An OpenStreetMap extract of the desired region</li>
<li>A compose file telling Docker how to set up ORS</li>
</ul>
<p>Of these, only Docker needs to be installed beforehand.
<code>ors_instance</code> can verify the installation and start Docker,
but it cannot assist in the installation process. You can get Docker
from <a href="https://docs.docker.com/get-docker/" class="external-link">here</a>. Local ORS
instances use Docker containers to host the service endpoints on a local
server.</p>
<p>OpenStreetMap (OSM) extracts are regional data files from the OSM
project. It contains spatial information relevant for routing such as
streets, buildings and natural features. OSM extracts are distributed by
providers such as <a href="https://download.geofabrik.de/" class="external-link">Geofabrik</a>
or <a href="https://extract.bbbike.org/" class="external-link">bbbike</a>. <code>rors</code>
wraps the <code>osmextract</code> package to match, download, and
process extract files.</p>
<p>Finally, a compose file is a file that instructs Docker how to create
a container. The <code>ors_instance</code> function helps adjust this
file, e.g. to change allocated memory or ports.</p>
<p>You can initialize a local ORS instance by passing a directory to
<code>ors_instance</code>. The function then creates a sub-directory
reserved for ORS and downloads a compose file from the official <a href="https://github.com/GIScience/openrouteservice" class="external-link">ORS Github
repository</a>. It then proceeds to “jumpstart” ORS, i.e. it starts a
default instance with default configurations and OSM data from
Heidelberg, Germany. This is probably not what you want, but worry not,
because you can make changes to this setup afterwards. Jumpstarting is
deemed good practice by the ORS developer team and simplifies the rest
of the setup.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ors_instance.html">ors_instance</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"."</span>, version <span class="op">=</span> <span class="st">"7c77ae5"</span>, prompts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/jumpstart.svg" width="100%"></p>
<p>Immediately after, we can take down the service to make changes to
the ORS setup:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">down</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/down.svg" width="100%"></p>
<p>The resulting <code>ors_instance</code> object is stored in a cache
environment for the entire R session. All API functions automatically
detect the currently mounted instance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_instance.html">get_instance</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/mount.svg" width="100%"></p>
<p>The instance object already shows some important information when
printed. We are dealing with a local instance on a localhost. The
instance is “active” in that it is currently mounted to the session and
it is “init” in that it was already built for the first time.</p>
<p><code>ors</code> is an R6 object and provides multiple methods to set
up a custom ORS instance. These methods can be divided into four
categories:</p>
<ul>
<li>
<strong>Extract</strong>: Methods and fields to interact with OSM
extracts</li>
<li>
<strong>Config</strong>: Methods and fields to interact with the
configuration</li>
<li>
<strong>Settings</strong>: Methods and fields to interact with the
compose file</li>
<li>
<strong>Docker</strong>: Methods and fields to interact with
Docker</li>
</ul>
<div class="section level3">
<h3 id="changing-the-extract">Changing the extract<a class="anchor" aria-label="anchor" href="#changing-the-extract"></a>
</h3>
<p>If we wanted to learn more about the currently selected OSM extract,
we can run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">extract</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/extract.svg" width="100%"></p>
<p>As you can see, we are currently running the default OSM file. If we
wanted to get a new extract, we can run:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">set_extract</span><span class="op">(</span><span class="st">"Rutland"</span>, provider <span class="op">=</span> <span class="st">"geofabrik"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/geofabrik.svg" width="100%"></p>
<p>This code runs <code><a href="https://docs.ropensci.org/osmextract/reference/oe_match.html" class="external-link">osmextract::oe_match</a></code> and
<code><a href="https://docs.ropensci.org/osmextract/reference/oe_download.html" class="external-link">osmextract::oe_download</a></code> to download an extract of the
British county Rutland. The extract is automatically added to the
compose file, so you don’t need to do anything else.</p>
</div>
<div class="section level3">
<h3 id="changing-the-configuration">Changing the configuration<a class="anchor" aria-label="anchor" href="#changing-the-configuration"></a>
</h3>
<p>ORS creates a <code>ors-config.yml</code> file inside the ORS
directory that holds the configuration for the service. If you have ever
used ORS before, chances are you have encountered errors that told you
about server-side limits. The config file is the place where these
limits are defined and where you can change them for your own setup.</p>
<p>The configuration especially includes the active routing profiles,
profile-specific options and endpoint-specific options. Routing profiles
are the transport modes used to do the routing with. The default is
<code>driving-car</code>, but there are several other profiles you can
choose from (refer to the <a href="https://openrouteservice.org/dev/#/api-docs/v2/directions/%7Bprofile%7D/post" class="external-link">API
playground</a>).</p>
<p>We can learn more about the currently active routing profiles:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">config</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/config.svg" width="100%"></p>
<p>As you can see, there is currently only one active profile:
<code>driving-car</code>. To add more profiles, we can use the
<code>$add_profiles</code> method. The method accepts either character
values or objects of class <code>ors_profile</code> - or a combination
of both. For quickly adding a new profile, you can simply refer to it by
name.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">add_profiles</span><span class="op">(</span><span class="st">"walking"</span>, <span class="fu"><a href="../reference/ors_profile.html">ors_profile</a></span><span class="op">(</span><span class="st">"hiking"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/add-profiles.svg" width="100%"></p>
<p>However, each routing profile comes with its own set of
configurations. To have a better control over the configurations in each
profile, we can create <code>ors_profile</code> objects. The following
code creates a walking profile with the same defaults as above, but
without taking into account elevation in its routing computations.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ors_profile.html">ors_profile</a></span><span class="op">(</span><span class="st">"walking"</span>, elevation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/profile.svg" width="100%"></p>
<p>To remove a profile, you can refer to it by name:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">rm_profiles</span><span class="op">(</span><span class="st">"hiking"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/rm-profiles.svg" width="100%"></p>
<p>Besides routing profiles, we can also change the configuration of
entire endpoints. Endpoints include <code>directions</code>,
<code>isochrones</code> and <code>matrix</code>. Each endpoint comes
with its own limitations. For example, by default we can only create
isochrones for 2 locations. To increase this limit, we can run:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">set_endpoints</span><span class="op">(</span>isochrone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maximum_locations <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/endpoints.svg" width="100%"></p>
<p>A full list of endpoint defaults set by ORS can be found in the <a href="https://giscience.github.io/openrouteservice/run-instance/configuration/ors/endpoints/" class="external-link">endpoint
reference</a>. A full list of profiles and their specific configuration
defaults can be found in the <a href="https://giscience.github.io/openrouteservice/run-instance/configuration/ors/engine/profiles" class="external-link">profile
reference</a>.</p>
</div>
<div class="section level3">
<h3 id="changing-the-compose-file">Changing the compose file<a class="anchor" aria-label="anchor" href="#changing-the-compose-file"></a>
</h3>
<p>The final step before starting the setup is to check the container
settings aka the <code>docker-compose.yml</code> file. You can check the
current status of the compose file by printing:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/compose.svg" width="100%"></p>
<p>By default, ORS uses 1 GB of initial memory and 2 GB of maximum
memory. This means that Docker starts allocating 1 GB of memory, but is
only allowed to allocate a maximum of 2 GB. You can adjust these
defaults to your needs using <code>$set_ram</code>. Usually, ORS
requires about 2.5 times the size of the extract file for each routing
profile as memory. You can either set the memory manually or let
<code>$set_ram</code> make an educated guess:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not passing anything tells `$set_ram` to freestyle</span></span>
<span><span class="va">ors</span><span class="op">$</span><span class="fu">set_ram</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/ram1.svg" width="100%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Alternatively, pass values directly (as GB)</span></span>
<span><span class="va">ors</span><span class="op">$</span><span class="fu">set_ram</span><span class="op">(</span>init <span class="op">=</span> <span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/ram2.svg" width="100%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span><span class="op">$</span><span class="va">memory</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/ram3.svg" width="100%"></p>
<p>Similarly, not passing anything to other compose methods, makes them
freestyle. <code>$set_name()</code> creates a random container name and
<code>$set_port()</code> assigns a random port.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">set_name</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/name1.svg" width="100%"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span><span class="op">$</span><span class="va">name</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/name2.svg" width="100%"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">set_port</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/port1.svg" width="100%"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span><span class="op">$</span><span class="va">ports</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/port2.svg" width="100%"></p>
</div>
<div class="section level3">
<h3 id="docker">Docker<a class="anchor" aria-label="anchor" href="#docker"></a>
</h3>
<p>The final step of the ORS setup is to start the Docker container and,
ultimately, the service. The Docker container can be controlled through
a purpose-tailored high-level Docker interface that understands the
following commands:</p>
<ul>
<li>Build and start a container (<code>$up()</code> /
<code>docker-compose up -d</code>)</li>
<li>Take a container down (<code>$down()</code> /
<code>docker-compose down</code>)</li>
<li>Start a container (<code>$start()</code> /
<code>docker-compose start</code>)</li>
<li>Stop a container (<code>$stop()</code> /
<code>docker-compose stop</code>)</li>
<li>Show logs (<code>$show_logs()</code> /
<code>docker logs</code>)</li>
</ul>
<p>The service can be started using the <code>$up()</code> method:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">up</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/up.svg" width="100%"></p>
<p>By default, <code>$up()</code> blocks the console until the setup is
done and gives out a visual and audible notification upon completion. If
the setup fails, <code>$up()</code> immediately invokes an informative
error. This is useful for short to moderately long setup times. However,
especially for longer setups, this can be obtrusive. By passing
<code>wait = FALSE</code>, the entire setup happens in a background
process and you can keep using the console. There are two tools that
enable you to monitor the setup progress nonetheless:</p>
<ul>
<li>
<code>$show_logs()</code>: Prints the ORS logs to the console.
Should the setup fail, this is the first place to look for errors. In
fact, <code>$up(wait = TRUE)</code> also uses Docker logs to determine
errors in the setup.</li>
<li>
<code>$is_ready()</code>: Shows whether the setup is done and ORS is
ready to use. It accesses the <code>health</code> endpoint to determine
whether the setup has completed without any errors.
<code>$is_ready()</code> is a simple wrapper around
<code><a href="../reference/get_instance.html">ors_ready()</a></code> which polls the currently mounted ORS
instance.</li>
</ul>
<p>When <code><a href="../reference/get_instance.html">ors_ready()</a></code> returns <code>TRUE</code>, you are
officially ready to use the rest of the package functions!</p>
</div>
</div>
<div class="section level2">
<h2 id="manual-changes">Manual changes<a class="anchor" aria-label="anchor" href="#manual-changes"></a>
</h2>
<p>The methods of an ORS instance object cover only some settings and
configurations. Many functionalities were deliberately left out to keep
the number of methods neat and tidy. If you are missing some important
feature, feel free to open a <a href="https://github.com/JsLth/rors/issues" class="external-link">Github issue</a>.</p>
<p>Yet, you can always make manual changes yourself. The methods
introduced above are merely convenience wrappers that take care of some
tedious tasks. Parsed versions of <code>ors-config.yml</code> and
<code>docker-compose.yml</code> are readily accessible in the instance
object:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">parsed</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/parsed1.svg" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span><span class="op">$</span><span class="va">parsed</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/parsed2.svg" width="100%"></p>
<p>Both objects are lists, which can simply be modified:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="va">compose</span><span class="op">$</span><span class="va">parsed</span><span class="op">$</span><span class="va">services</span><span class="op">$</span><span class="va">`ors-app`</span><span class="op">$</span><span class="va">container_name</span> <span class="op">&lt;-</span> <span class="st">"new-name-123"</span></span></code></pre></div>
<p>One caveat is that such simple assignments only change the state of
the object, but not the state of the actual files. To synchronize the
ORS file system, you have to <code>$update()</code> after making manual
changes:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This command writes the current state of the parsed ORS files to
disk. Conversely, if you make manual changes to one of the relevant ORS
files, you can update the R instance object using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="st">"self"</span><span class="op">)</span></span></code></pre></div>
<p>This command re-parses all ORS files. Again, it is advisable to make
the majority of changes using the convenience wrappers as they
automatically update and mount the instance object. Manually updating
the instance is prone to errors which can be quite hard to spot and
debug.</p>
</div>
<div class="section level2">
<h2 id="other-methods">Other methods<a class="anchor" aria-label="anchor" href="#other-methods"></a>
</h2>
<p>ORS instance objects contain some other important functions that
didn’t make it into this vignette. Among them are:</p>
<ul>
<li>
<code>$is_built()</code> / <code>$is_running()</code>: Check whether
a container is built and running. These are the two steps before a
service is ready and are useful to monitor a container before the
service is ready.</li>
<li>
<code>$is_mounted()</code>: Checks whether an instance is currently
mounted to the session. If not the case, simply invoke one of the
methods (e.g. <code>$update()</code>) to mount it.</li>
<li>
<code>$get_image()</code> / <code>$get_container()</code> Return
some useful diagnostics about the image and container.</li>
<li>
<code>$get_status()</code>: Returns configurations and attributes of
the ORS service (given that the service is ready).</li>
<li>
<code>$purge()</code>: Purges an ORS instance, i.e. takes down
containers, deletes the ORS directory and cleans the instance
object.</li>
<li>
<code>$rm_extract()</code>: Removes one or several extracts from the
ORS directory.</li>
<li>
<code>$report()</code>: Prints a situation report of the ORS
instance object.</li>
</ul>
</div>
<div class="section level2">
<h2 id="fin">Fin<a class="anchor" aria-label="anchor" href="#fin"></a>
</h2>
<p>To finalize an ORS instance, you can run <code>ors$purge()</code>.
Purging an instance takes down any running container, (optionally)
deletes the image, unlinks the created sub-directory and cleans up the
ORS object. ORS instances also register a finalizer that automatically
purges the ORS instance just before garbage collection when it is
unbinded using <code>rm(ors)</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ors</span><span class="op">$</span><span class="fu">purge</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/ors-installation/purge.svg" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lieth Jonas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
